<% layout("/layouts/boilerplate") %>

  <style>
    .edit-container {
      max-width: 800px;
      margin: 2rem auto;
      background: var(--surface);
      padding: 2rem;
      border-radius: 1rem;
      box-shadow: var(--shadow);
    }

    .edit-header {
      color: var(--primary);
      font-weight: 700;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid var(--primary);
    }

    .preview-image {
      max-width: 100%;
      height: auto;
      border-radius: 0.75rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      margin-bottom: 1rem;
    }

    .image-preview-section {
      background: var(--bg);
      padding: 1rem;
      border-radius: 0.5rem;
      margin-bottom: 1rem;
    }

    .btn-teal {
      background-color: var(--primary);
      color: white;
      border: none;
      transition: background-color 0.3s ease, transform 0.2s ease;
      font-weight: 600;
      padding: 0.6rem 2rem;
    }

    .btn-teal:hover {
      background-color: var(--primary-dark);
      transform: translateY(-2px);
      color: white;
    }

    .btn-teal:active {
      transform: translateY(0);
    }

    .category-select {
      min-height: 250px;
    }

    .form-actions {
      display: flex;
      gap: 1rem;
      justify-content: flex-start;
      margin-top: 2rem;
    }

    @media (max-width: 768px) {
      .edit-container {
        padding: 1.5rem;
        margin: 1rem;
      }

      .form-actions {
        flex-direction: column;
      }

      .form-actions .btn {
        width: 100%;
      }
    }
  </style>

  <div class="edit-container">
    <h3 class="edit-header">
      <i class="fas fa-edit"></i> Edit Your Listing
    </h3>

    <form action="/listings/<%= listing.id %>?_method=PUT" method="POST" enctype="multipart/form-data" novalidate
      class="needs-validation">

      <!-- Title -->
      <div class="mb-3">
        <label for="title" class="form-label">
          <i class="fas fa-heading"></i> Title <span class="text-danger">*</span>
        </label>
        <input id="title" name="listing[title]" value="<%= listing.title %>" type="text" class="form-control"
          placeholder="Enter a catchy title" maxlength="100" required />
        <div class="valid-feedback">Title looks good!</div>
        <div class="invalid-feedback">Please enter a valid title (max 100 characters)</div>
      </div>

      <!-- Description -->
      <div class="mb-3">
        <label for="description" class="form-label">
          <i class="fas fa-align-left"></i> Description <span class="text-danger">*</span>
        </label>
        <textarea id="description" name="listing[description]" class="form-control" rows="5"
          placeholder="Describe your property in detail" maxlength="3500" required><%= listing.description %></textarea>
        <small class="text-muted">Maximum 3500 characters</small>
        <div class="invalid-feedback">Please enter a description</div>
      </div>

      <!-- Original Image Preview -->
      <div class="mb-3 image-preview-section">
        <label class="form-label">
          <i class="fas fa-image"></i> Current Listing Image
        </label>
        <div>
          <img src="<%= originalImageUrl %>" alt="<%= listing.title %>" class="preview-image" />
        </div>
      </div>

      <!-- Upload New Image -->
      <div class="mb-3">
        <label for="image" class="form-label">
          <i class="fas fa-upload"></i> Upload New Image (Optional)
        </label>
        <input id="image" name="listing[image]" class="form-control" type="file"
          accept="image/jpeg,image/png,image/webp,image/jpg" />
        <small class="text-muted">Leave empty to keep current image. Accepted: JPG, PNG, WEBP (Max 5MB)</small>
      </div>

      <!-- Price & Country Row -->
      <div class="row">
        <div class="mb-3 col-md-4">
          <label for="price" class="form-label">
            <i class="fas fa-dollar-sign"></i> Price (per night) <span class="text-danger">*</span>
          </label>
          <input id="price" name="listing[price]" value="<%= listing.price %>" class="form-control" type="number"
            min="0" step="0.01" placeholder="0.00" required />
          <div class="invalid-feedback">Enter a valid price</div>
        </div>

        <div class="mb-3 col-md-8">
          <label for="country" class="form-label">
            <i class="fas fa-globe"></i> Country <span class="text-danger">*</span>
          </label>
          <input id="country" name="listing[country]" value="<%= listing.country %>" class="form-control" type="text"
            placeholder="e.g., United States" required />
          <div class="invalid-feedback">Please enter a valid country name</div>
        </div>
      </div>

      <!-- Location -->
      <div class="mb-3">
        <label for="location" class="form-label">
          <i class="fas fa-map-marker-alt"></i> Location <span class="text-danger">*</span>
        </label>
        <input id="location" name="listing[location]" value="<%= listing.location %>" class="form-control" type="text"
          placeholder="e.g., New York, NY" required />
        <div class="invalid-feedback">Please enter a valid location</div>
      </div>

      <!-- Category -->
      <div class="mb-3">
        <label class="form-label">
          <i class="fas fa-tags"></i> Category <span class="text-danger">*</span>
        </label>
        <small class="d-block text-muted mb-2">
          Hold <kbd>Ctrl</kbd> (Windows) or <kbd>Cmd</kbd> (Mac) to select multiple categories
        </small>
        <select name="listing[category]" class="form-select category-select" multiple required>
          <option value="Trending" <%=listing.category && listing.category.includes('Trending') ? 'selected' : '' %>>
            Trending
          </option>
          <option value="Budget Stays" <%=listing.category && listing.category.includes('Budget Stays') ? 'selected'
            : '' %>>
            Budget Stays
          </option>
          <option value="Luxury" <%=listing.category && listing.category.includes('Luxury') ? 'selected' : '' %>>
            Luxury
          </option>
          <option value="Rooms" <%=listing.category && listing.category.includes('Rooms') ? 'selected' : '' %>>
            Rooms
          </option>
          <option value="Apartments" <%=listing.category && listing.category.includes('Apartments') ? 'selected' : '' %>
            >
            Apartments
          </option>
          <option value="Family" <%=listing.category && listing.category.includes('Family') ? 'selected' : '' %>>
            Family
          </option>
          <option value="Pet Friendly" <%=listing.category && listing.category.includes('Pet Friendly') ? 'selected'
            : '' %>>
            Pet Friendly
          </option>
          <option value="Tourist Spots" <%=listing.category && listing.category.includes('Tourist Spots') ? 'selected'
            : '' %>>
            Tourist Spots
          </option>
          <option value="Monthly Stays" <%=listing.category && listing.category.includes('Monthly Stays') ? 'selected'
            : '' %>>
            Monthly Stays
          </option>
        </select>
        <div class="invalid-feedback">Please select at least one category</div>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <button type="submit" class="btn btn-teal">
          <i class="fas fa-save"></i> Save Changes
        </button>
        <a href="/listings/<%= listing.id %>" class="btn btn-outline-secondary">
          <i class="fas fa-times"></i> Cancel
        </a>
      </div>
    </form>
  </div>